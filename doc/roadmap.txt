Browser Search + Docs Reader MCP Server (Rust + Brave + SQLite)        *mcp-web*
================================================================================
K. Milestones                                                                *K*
================================================================================

K1. Milestone 1: MCP stdio server (no network)
--------------------------------------------------------------------------------
- [x] rmcp server boots on stdio (tools registered via #[tool])
- [x] Implement web_extract via Lectito (Document::parse + extract_content)
      (Use git url: https://github.com/stormlightlabs/lectito)

K2. Milestone 2: SQLite cache + migrations
--------------------------------------------------------------------------------
- [x] Implement cache mod with tokio_rustqlite
- [x] Add migrations for snapshots/search_cache (C2)
- [x] Enable WAL + pragmas (C3)
- [x] cache_get + cache_purge tools

K3. Milestone 3: HTTP fetch pipeline (safe) + readable mode
--------------------------------------------------------------------------------
- [x] Implement SSRF checks + redirect limits + max_bytes (E2)
- [x] Implement robots.txt fetch + decision cache (E3)
- [x] Implement web_open(readable):
      fetch HTML -> Lectito extract -> markdown normalize -> cache

K4. Milestone 4: Brave web_search tool
--------------------------------------------------------------------------------
- [x] Implement brave-client:
      - headers/auth
      - q/count/offset/freshness/safesearch/country/lang/extra_snippets
- [x] Normalize results + return more_results_available where possible
- [x] Add short TTL search_cache table usage
Refs: Brave web search docs for pagination, safesearch, freshness, snippets.

K5. Milestone 5: Configuration Loading
--------------------------------------------------------------------------------
- [x] Define AppConfig struct with serde defaults matching doc/configuration.txt
- [x] Integrate figment with layered loading: defaults → TOML file → env vars
- [x] Add MCP_WEB_CONFIG_FILE env var for optional TOML config path
- [x] Validate config at startup (API key presence, valid ranges)
- [x] Wire config into McpWebServer and all tool contexts
Refs: figment crate, twelve-factor app config.

K6. Milestone 6: Batch operations + extraction diagnostics
--------------------------------------------------------------------------------
- [x] web_batch_open with bounded concurrency
- [x] Add "debug: explain_extraction" output to help tuning
      (e.g., extraction time, character count, links count)
- [x] Add "domain_allowlist" post-filter for search results (A2)
- [x] Add stable markdown header + link harvest (F4)
Note: Full site-config pipeline deferred. Lectito's auto-detection handles most
sites. If specific sites need custom XPath rules, consider adding them upstream
in lectito-core. The siteconfig_id column exists for future use.

K7. Milestone 7: Rendered mode (feature gated)
--------------------------------------------------------------------------------
- [ ] Add render crate (rust-headless-chrome or chromiumoxide)
- [ ] Render HTML via headless browser -> feed HTML to Lectito
- [ ] This keeps *one* extraction engine across raw vs rendered flows.
Refs: headless Chrome control options.

K8. Milestone 8: Hardening + observability
--------------------------------------------------------------------------------
- [ ] JSONL logs + metrics counters (H4)
- [ ] Fuzz-ish tests for URL parsing inputs
- [ ] Cache purge policy (C4) + size ceiling
- [ ] Add documentation: SECURITY.md + threat model

K9. Milestone 9: Packaging + integration with your agent harness
--------------------------------------------------------------------------------
- [ ] Provide a single binary release
